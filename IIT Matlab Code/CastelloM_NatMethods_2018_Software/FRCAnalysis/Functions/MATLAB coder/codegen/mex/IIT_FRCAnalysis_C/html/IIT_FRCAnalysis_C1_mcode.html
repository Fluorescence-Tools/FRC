<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">result</span>] = IIT_FRCAnalysis_C(<span class="var type1" id="S3T2U6">im1</span>, <span class="var type1" id="S4T2U7">im2</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">%   Default parameters</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line"><span class="var type0" id="S5T0U10">pixelSize</span> = 0.025;</span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line"><span class="var type0" id="S6T0U14">meanFilterWidth</span> = 3;</span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line"><span class="var type0" id="S7T0U18">maxIterations</span> = 200;</span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line"><span class="var type0" id="S8T0U22">roiRadius</span> = 5;</span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line"><span class="var type0" id="S9T0U26">theta</span> = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line"><span class="var type1" id="S3T2U30">im1</span> = double(<span class="var type1" id="S3T2U33">im1</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line"><span class="var type1" id="S4T2U36">im2</span> = double(<span class="var type1" id="S4T2U39">im2</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line"><span class="var type1" id="S11T3U42">N</span> = size(<span class="var type1" id="S3T2U45">im1</span>,1);                        <span class="comment">%   Number of pixels;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line"><span class="keyword">if</span> mod(<span class="var type1" id="S11T3U52">N</span>,2)==0</span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line">    <span class="var type0" id="S14T0U57">Scale</span> = (0:(<span class="var type1" id="S11T3U65">N</span>/2-1))/(<span class="message error" id="M1F1C">params</span>.pixelSize*<span class="var type0" id="S11T0U73">N</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line">    <span class="var type0" id="S14T0U77">Scale</span> = (0:(<span class="var type1" id="S11T3U84">N</span>/2))/(<span class="message error" id="M2F1C">params</span>.pixelSize*<span class="var type0" id="S11T0U91">N</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line"><span class="var type0" id="S14T0U94">Scale</span> = <span class="var type0" id="S14T0U96"><span class="message error" id="M3F1C">Scale</span></span>';</span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line"><span class="var type1" id="S16T2U99">Hm</span> =<span class="fcn" id="F45N3:B101">IIT_Hamming</span>(<span class="var type1" id="S11T3U102">N</span>,<span class="var type1" id="S11T3U103">N</span>);                   <span class="comment">%   Hamming function</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line"><span class="comment">%Shift = [0 0];</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line"><span class="var type0" id="S18T0U106">Shift</span> = zeros(1,2,<span class="message error" id="M4F1C">d</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line"><span class="var type1" id="S21T4U115">fftA</span> = fftshift(fft2(<span class="var type1" id="S3T2U121">im1</span> .* <span class="var type1" id="S16T2U122">Hm</span>));</span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line"><span class="var type1" id="S24T4U125">fftB</span> = fftshift(fft2(<span class="var type1" id="S4T2U131">im2</span> .* <span class="var type1" id="S16T2U132">Hm</span>));</span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28">28</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29">29</a></span><span class="line">[<span class="var type0" id="S25T0U136"><span class="message error" id="M6F1C">FRC</span></span>, <span class="var type0" id="S26T0U137"><span class="message error" id="M7F1C">threeSigma</span></span>, <span class="var type0" id="S27T0U138"><span class="message error" id="M8F1C">fiveSigma</span></span>] = IIT_performFRC(<span class="var type1" id="S21T4U141">fftA</span>, <span class="var type1" id="S24T4U142">fftB</span>, <span class="message error" id="M5F1C">h</span>, w, <span class="var type0" id="S9T0U147">theta</span> );</span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30">30</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31">31</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32">32</a></span><span class="line"><span class="var type0" id="S31T0U151">sFRC</span>.smallAngles = IIT_meanFilter(<span class="var type0" id="S25T0U156"><span class="message error" id="M9F1C">FRC</span></span>.smallAngles, <span class="var type0" id="S6T0U158">meanFilterWidth</span>);         <span class="comment">% smooth FRC via mean filter</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33">33</a></span><span class="line"><span class="var type0" id="S31T0U162">sFRC</span>.largeAngles = IIT_meanFilter(<span class="var type0" id="S25T0U167"><span class="message error" id="M10F1C">FRC</span></span>.largeAngles, <span class="var type0" id="S6T0U169">meanFilterWidth</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34">34</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35">35</a></span><span class="line"><span class="var type0" id="S33T0U172">fixedThreshold</span> = 1/7 * ones(size(<span class="var type0" id="S14T0U181"><span class="message error" id="M11F1C">Scale</span></span>,1),1);</span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36">36</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37">37</a></span><span class="line"><span class="comment">% CutOff frequencies for different threshold criteria - build a</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38">38</a></span><span class="line"><span class="comment">% function</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39">39</a></span><span class="line"><span class="var type0" id="S35T0U187">cutOff</span>.fixedThreshold_smallAngles = IIT_findIntercept(<span class="var type0" id="S31T0U192"><span class="message error" id="M12F1C">sFRC</span></span>.smallAngles, <span class="var type0" id="S33T0U194">fixedThreshold</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40">40</a></span><span class="line"><span class="var type0" id="S35T0U198">cutOff</span>.threeSigma_smallAngles = IIT_findIntercept(<span class="var type0" id="S31T0U203"><span class="message error" id="M13F1C">sFRC</span></span>.smallAngles, <span class="var type0" id="S26T0U205">threeSigma</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41">41</a></span><span class="line"><span class="var type0" id="S35T0U209">cutOff</span>.fiveSigma_smallAngles = IIT_findIntercept(<span class="var type0" id="S31T0U214"><span class="message error" id="M14F1C">sFRC</span></span>.smallAngles, <span class="var type0" id="S27T0U216">fiveSigma</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42">42</a></span><span class="line"><span class="var type0" id="S35T0U220">cutOff</span>.fixedThreshold_largeAngles = IIT_findIntercept(<span class="var type0" id="S31T0U225"><span class="message error" id="M15F1C">sFRC</span></span>.largeAngles, <span class="var type0" id="S33T0U227">fixedThreshold</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43">43</a></span><span class="line"><span class="var type0" id="S35T0U231">cutOff</span>.threeSigma_largeAngles = IIT_findIntercept(<span class="var type0" id="S31T0U236"><span class="message error" id="M16F1C">sFRC</span></span>.largeAngles, <span class="var type0" id="S26T0U238">threeSigma</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44">44</a></span><span class="line"><span class="var type0" id="S35T0U242">cutOff</span>.fiveSigma_largeAngles = IIT_findIntercept(<span class="var type0" id="S31T0U247"><span class="message error" id="M17F1C">sFRC</span></span>.largeAngles, <span class="var type0" id="S27T0U249">fiveSigma</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45">45</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46">46</a></span><span class="line">[<span class="var type0" id="S35T0U253"><span class="message error" id="M19F1C">cutOff</span></span>, <span class="var type0" id="S37T0U254"><span class="message error" id="M20F1C">resolution</span></span>] = measureResolution(<span class="var type0" id="S14T0U257"><span class="message error" id="M18F1C">Scale</span></span>, <span class="var type0" id="S35T0U258">cutOff</span>, params);</span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47">47</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48">48</a></span><span class="line"><span class="var type0" id="S2T0U264">result</span>.FRC = <span class="var type0" id="S25T0U266"><span class="message error" id="M21F1C">FRC</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49">49</a></span><span class="line"><span class="var type0" id="S2T0U270">result</span>.sFRC = <span class="var type0" id="S31T0U272"><span class="message error" id="M22F1C">sFRC</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50">50</a></span><span class="line"><span class="var type0" id="S2T0U276">result</span>.Resolution = <span class="var type0" id="S37T0U278"><span class="message error" id="M23F1C">resolution</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51">51</a></span><span class="line"><span class="var type0" id="S2T0U282">result</span>.Im1 = <span class="var type1" id="S3T2U284">im1</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52">52</a></span><span class="line"><span class="var type0" id="S2T0U288">result</span>.Im2 = <span class="var type1" id="S4T2U290">im2</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53">53</a></span><span class="line"><span class="var type0" id="S2T0U294">result</span>.Scale = <span class="var type0" id="S14T0U296"><span class="message fatal" id="M24F1C">Scale</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54">54</a></span><span class="line"><span class="var type0" id="S2T0U300">result</span>.N = <span class="var type0" id="S11T0U302">N</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55">55</a></span><span class="line"><span class="var type0" id="S2T0U306">result</span>.Shift = <span class="var type0" id="S18T0U308">Shift</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56">56</a></span><span class="line"><span class="var type0" id="S2T0U312">result</span>.PixelSize = <span class="var type0" id="S5T0U314">pixelSize</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57">57</a></span><span class="line"><span class="var type0" id="S2T0U318">result</span>. MeanFilterWidth = <span class="var type0" id="S6T0U320">meanFilterWidth</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58">58</a></span><span class="line"><span class="var type0" id="S2T0U324">result</span>.DriftCorrected = driftCorrection;</span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59">59</a></span><span class="line"><span class="var type0" id="S2T0U331">result</span>.ThreeSigma = <span class="var type0" id="S26T0U333">threeSigma</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60">60</a></span><span class="line"><span class="var type0" id="S2T0U337">result</span>.FiveSigma = <span class="var type0" id="S27T0U339">fiveSigma</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61">61</a></span><span class="line"><span class="var type0" id="S2T0U343">result</span>.FixedThreshold = <span class="var type0" id="S33T0U345">fixedThreshold</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62">62</a></span><span class="line"><span class="var type0" id="S2T0U349">result</span>.Theta = <span class="var type0" id="S9T0U351">theta</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63">63</a></span><span class="line"><span class="var type0" id="S2T0U355">result</span>.CutOff = <span class="var type0" id="S35T0U357">cutOff</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64">64</a></span><span class="line"><span class="var type0" id="S2T0U361">result</span>.Title = title;</span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65">65</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
